---
- name: Confirm Prereqs
  ansible.builtin.apt:
    name: ["ca-certificates", "curl", "gnupg", "lsb-release" ]
    update_cache: yes

- name: Add Docker GPG Key
  ansible.builtin.get_url: 
    url: https://download.docker.com/linux/ubuntu/gpg
    dest: /usr/share/keyrings/docker-archive-keyring.gpg

- name: Add Docker Sources
  ansible.builtin.shell: 
    cmd: echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu impish stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
    creates: /etc/apt/sources.list.d/docker.list 

- name: Install Docker Engine
  ansible.builtin.apt:
    name: ["docker-ce", "docker-ce-cli", "containerd.io", "docker-compose-plugin"]
    update_cache: yes

- name: Add Seclab to Docker
  ansible.builtin.user:
    groups: docker
    append: yes
    name: seclab
